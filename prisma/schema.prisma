generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Producto {
  id               Int      @id @default(autoincrement())
  nombre           String
  slug             String   @unique
  descripcionCorta String?
  descripcionLarga String?   // üëà NUEVO

  /// si quer√©s conservar una categor√≠a principal de texto:
  categoria        String?

  precio           Float
  imagen           String?
  stock            Int?     @default(0)
  activo           Boolean  @default(true)
  destacado        Boolean  @default(false)
  orden            Int      @default(0)
  creadoEn         DateTime @default(now())
  actualizadoEn    DateTime @updatedAt

  itemsPedido PedidoItem[]

  // üîπ Relaci√≥n muchas-a-muchas con Categor√≠a
  categorias ProductosCategorias[]
}

model Categoria {
  id    Int    @id @default(autoincrement())
  nombre String
  slug   String @unique

  productos ProductosCategorias[]
}

/// tabla puente expl√≠cita para la relaci√≥n N-a-N
model ProductosCategorias {
  productoId Int
  categoriaId Int

  producto  Producto  @relation(fields: [productoId], references: [id])
  categoria Categoria @relation(fields: [categoriaId], references: [id])

  @@id([productoId, categoriaId])
}


model User {
  id           Int      @id @default(autoincrement())
  name         String?
  email        String   @unique
  passwordHash String
  role         String   @default("USER")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  pedidos Pedido[]
}

model Pedido {
  id          Int    @id @default(autoincrement())
  numero      String
  subtotal    Int
  descuento   Int      @default(0)
  costoEnvio  Int
  total       Int
  estado      String @default("pendiente")
  metodoEnvio String @default("desconocido")

  // üîπ Relaci√≥n con el usuario (opcional)
  userId Int?
  user   User? @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  items PedidoItem[]

  // üîπ CAMPOS DE CHECKOUT Y ENV√çO
  nombreCliente   String?
  apellidoCliente String?
  emailCliente    String?
  telefonoCliente String?
  dniCliente      String?

  tipoEntrega    String?
  direccion      String?
  ciudad         String?
  provincia      String?
  codigoPostal   String?
  sucursalCorreo String?

  notasCliente       String?
  fechaEstimadaEnvio DateTime?
}

model PedidoItem {
  id             Int    @id @default(autoincrement())
  pedidoId       Int
  productoId     Int?
  nombreProducto String
  cantidad       Int
  subtotal       Int

  pedido   Pedido    @relation(fields: [pedidoId], references: [id])
  producto Producto? @relation(fields: [productoId], references: [id])
}
